<section
  class="py-16 lg:py-24 text-brand-textPrimary transition-colors duration-300"
>
  <div class="container mx-auto px-6 lg:px-8">
    <header class="section-heading text-center max-w-3xl mx-auto mb-12">
      <h2
        id="easy-locker-testimonials-title"
        class="text-3xl md:text-4xl lg:text-5xl font-bold text-brand-textPrimary text-center dark:text-brand-darkTextStrong"
      >
        {{ "sections.testimonials.title" | translate }}
      </h2>
      <p
        class="mt-2 text-base md:text-lg text-brand-textSecondary text-center max-w-xl mx-auto"
      >
        {{ "sections.testimonials.subtitle" | translate }}
      </p>
      <div class="easy-section-underline"></div>
    </header>

    <div class="mt-10">
      <div *ngIf="hasReviews; else testimonialsFallback" class="mt-10">
        <div class="relative max-w-6xl mx-auto">
          <button
            type="button"
            class="control-compact absolute -left-5 md:-left-10 top-1/2 -translate-y-1/2 z-10"
            (click)="onPrevClick()"
            [disabled]="!canNavigate"
            [class.opacity-50]="!canNavigate"
            [class.pointer-events-none]="!canNavigate"
          >
            <span class="sr-only">Anterior</span>
            <svg
              class="h-4 w-4"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
            >
              <path d="M15 18l-6-6 6-6" />
            </svg>
          </button>

          <button
            type="button"
            class="control-compact absolute -right-5 md:-right-10 top-1/2 -translate-y-1/2 z-10"
            (click)="onNextClick()"
            [disabled]="!canNavigate"
            [class.opacity-50]="!canNavigate"
            [class.pointer-events-none]="!canNavigate"
          >
            <span class="sr-only">Siguiente</span>
            <svg
              class="h-4 w-4"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
            >
              <path d="M9 6l6 6-6 6" />
            </svg>
          </button>

          <div class="overflow-hidden carousel-viewport">
            <div
              class="flex items-stretch transition-transform ease-out"
              [style.transform]="sliderTransform"
              [style.will-change]="'transform'"
              [style.transitionDuration]="trackTransitionDuration"
              (transitionend)="onTrackTransitionEnd()"
            >
              <div
                *ngFor="let review of carouselReviews; trackBy: trackByAuthor"
                class="flex-none box-border px-3 lg:px-4"
                [style.width.%]="slideWidthPercentage"
              >
                <app-easy-card
                  as="div"
                  [interactive]="true"
                  align="left"
                  paddingClass="p-0"
                >
                  <article class="testimonial-card flex flex-col gap-4 p-6">
                    <div
                      *ngIf="getStars(review.rating).length"
                      class="flex items-center gap-1 text-brand-accentPrimary text-xl"
                      role="img"
                      [attr.aria-label]="
                        'testimonials_rating_aria'
                          | translate : { rating: review.rating || 0 }
                      "
                    >
                      <span
                        *ngFor="let _ of getStars(review.rating)"
                        aria-hidden="true"
                        >â˜…</span
                      >
                    </div>
                    <p
                      class="text-sm text-brand-textSecondary leading-relaxed whitespace-pre-line break-words"
                    >
                      {{ review.text }}
                    </p>
                    <div class="mt-2 flex flex-col text-sm text-brand-textSecondary">
                      <span class="font-semibold text-brand-textPrimary truncate">
                        {{ review.author }}
                      </span>
                      <small *ngIf="review.date" class="truncate">{{ review.date }}</small>
                    </div>
                  </article>
                </app-easy-card>
              </div>
            </div>
          </div>
        </div>
      </div>

      <ng-template #testimonialsFallback>
        <div
          *ngIf="isLoading"
          class="bg-brand-surface border border-dashed border-brand-border rounded-2xl px-6 py-16 text-center text-brand-textSecondary"
        >
          <p class="text-base">
            {{ "testimonials_placeholder_loading" | translate }}
          </p>
        </div>

        <section *ngIf="!isLoading" class="mt-8 md:mt-10">
          <div
            class="max-w-3xl mx-auto px-5 sm:px-8 py-8 rounded-3xl bg-brand-surface border border-brand-borderSubtle shadow-[var(--easy-shadow-elevated-soft)]"
          >
            <div
              class="w-10 h-10 mx-auto mb-3 flex items-center justify-center rounded-full bg-brand-backgroundSoft/80 text-brand-accentPrimary/90"
            >
              <svg
                class="w-5 h-5"
                viewBox="0 0 24 24"
                fill="currentColor"
                aria-hidden="true"
              >
                <path
                  d="M9.5 11.75c0 3.72-1.92 6.5-5 6.5-.35 0-.5-.15-.5-.5 0-.17.03-.35.08-.52.3-1 .76-1.94 1.38-2.83.63-.9 1.36-1.74 2.2-2.53L7 12h-.5c-1.33 0-2-.5-2-1.5 0-1.36 1.03-2.5 3-2.5 1.7 0 2.75 1.04 2.75 3.75Zm11 0c0 3.72-1.92 6.5-5 6.5-.35 0-.5-.15-.5-.5 0-.17.03-.35.08-.52.3-1 .76-1.94 1.38-2.83.63-.9 1.36-1.74 2.2-2.53l-.15.13h-.5c-1.34 0-2-.5-2-1.5 0-1.36 1.03-2.5 3-2.5 1.7 0 2.75 1.04 2.75 3.75Z"
                />
              </svg>
            </div>
            <h3
              class="text-xl md:text-2xl font-semibold text-brand-textPrimary text-center"
            >
              {{ "testimonials_empty_title" | translate }}
            </h3>
            <p
              class="mt-2 text-base md:text-lg text-brand-textSecondary text-center max-w-xl mx-auto leading-relaxed"
            >
              {{ "testimonials_empty_body" | translate }}
            </p>
            <div class="mt-6 flex flex-col sm:flex-row gap-4 sm:gap-6 justify-center items-center">
              <a
                class="easy-pill-btn easy-cta-primary w-full sm:w-auto justify-center"
                [href]="reviewUrl"
                target="_blank"
                rel="noopener noreferrer"
                (click)="onLeaveReviewClick()"
                [attr.aria-label]="'testimonials_button_review_aria' | translate"
              >
                {{ "testimonials_button_review" | translate }}
              </a>
              <a
                class="easy-pill-btn easy-cta-secondary w-full sm:w-auto justify-center"
                [href]="profileUrl"
                target="_blank"
                rel="noopener noreferrer"
                (click)="onViewProfileClick()"
                [attr.aria-label]="'testimonials_button_profile_aria' | translate"
              >
                {{ "testimonials_button_profile" | translate }}
              </a>
            </div>
          </div>
          <p class="mt-5 text-xs md:text-sm text-brand-textMuted text-center max-w-3xl mx-auto leading-relaxed">
            {{ "testimonials_empty_trust" | translate }}
          </p>
        </section>
      </ng-template>

      <p
        *ngIf="hasReviews"
        class="mt-8 text-center text-sm text-brand-accentPrimary"
      >
        {{ summaryTranslationKey | translate }}
      </p>

      <p
        *ngIf="hasReviews && lastUpdatedDisplay"
        class="mt-2 text-center text-xs text-brand-textMuted"
      >
        {{ lastUpdatedDisplay }}
      </p>

      <div
        *ngIf="hasReviews"
        class="mt-6 flex justify-center"
      >
        <a
          class="easy-pill-btn easy-cta-secondary mx-auto"
          [href]="profileUrl"
          target="_blank"
          rel="noopener noreferrer"
          (click)="onViewProfileClick()"
          [attr.aria-label]="'testimonials_button_all_reviews_aria' | translate"
        >
          {{ "testimonials_button_all_reviews" | translate }}
        </a>
      </div>
    </div>

  </div>
</section>
